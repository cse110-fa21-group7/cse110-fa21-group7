<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js/search-recipe.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeCard.html">RecipeCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeCard.html#setPage">setPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeCard.html#setPage">setPage</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCurated">addCurated</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addExamples">addExamples</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addList">addList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#bindEscKey">bindEscKey</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#bindNavbarLinks">bindNavbarLinks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkID">checkID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkValid">checkValid</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createSections">createSections</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#currInit">currInit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchFullRecipe">fetchFullRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchRecipes">fetchRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#file">file</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getID">getID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getPage">getPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRecipesFromCache">getRecipesFromCache</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#hasFloat">hasFloat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#hasValue">hasValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#makePage">makePage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateForm">populateForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateHTML">populateHTML</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#readRecipe">readRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#recipeCards">recipeCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeTags">removeTags</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setButtonListener">setButtonListener</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setSearchListener">setSearchListener</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showError">showError</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showMessage">showMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showSuccess">showSuccess</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#spoonToASAP">spoonToASAP</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">js/search-recipe.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>window.addEventListener("DOMContentLoaded", init);

/** Initialize function, begins all of the JS code in this file */
async function init() {
  setSearchListener();
}

/**
 * Fetches search results and populates index.html
 * @param {String} query
 * @return {null}
 */
async function fetchRecipes(query) {
  const url = `/search/recipe?query=${query}`;
  const res = await fetch(url); // return back the reicpes object from spoonacular
  const data = await res.json();
  console.log(data);
  if (data.cod === "404") {
    alert("Recipe not found");
    return;
  }
  if (data.cod === 401) {
    alert("Invalid API Key");
    return;
  }
  // --- we should use recipes ID to fetch all recipe's info, need other team member implement this part------
  const storage = window.localStorage;
  // const resultRecipes = JSON.parse(storage.getItem("resultRecipes"));
  // Overwrite resultRecipes on each search.
  const resultRecipes = {};

  for (const recipe of data["results"]) {
    resultRecipes[recipe["id"]] = recipe;
  }

  // update
  // Store full recipes in searchedRecipes
  localStorage.setItem("resultRecipes", JSON.stringify(resultRecipes));

  // displaySearchResults(data["results"]);

  // log the result
  setTimeout(() => {
    console.log(data["results"]);
  }, 10);
  const urlchange = `/result?query=${query}`;
  window.location.href = urlchange;
  // for (const [key, value] of Object.entries(recipes)) {
  //   if (key !== "currID") {
  //     recipeData[key] = value;
  //   }
  // }
  // console.log(recipeData);
  // return true;
}

/**
 * Set up event listener for search
 */
function setSearchListener() {
  // const searchForm = document.getElementById("search-form");
  const searchbtn = document.getElementById("search-button");
  searchbtn.addEventListener("click", (e) => {
    e.preventDefault();
    const searchField = document.getElementById("query");

    const queryText = searchField.value;
    console.log(`Search query: ${queryText}`);
    if (queryText.value === "") {
      alert("Please enter recipe you want to search");
    } else {
      fetchRecipes(queryText);
    }
  });

  /*
    // fetch the recipes and wait for them to load
    const fetchSuccessful = await fetchRecipes();
    // if they didn't successfully load, quit the function
    if (!fetchSuccessful) {
      console.log("Recipe fetch unsuccessful");
      return;
    }
    // Add the first three recipe cards to the page
    createRecipeCards();
    */
}

// let cardTemplate = null;

/**
 * Populates index.html results section with recipe card elements
 * @param {Object} searchedRecipeIDs
 */
// function displaySearchResults(searchedRecipeIDs) {
//   const curatedList = document.getElementById("curated-list");
//   curatedList.style.visibility = "hidden";
//   let recipeCardDiv;
//   if (cardTemplate == null) {
//     recipeCardDiv = curatedList.querySelector(".card");
//     recipeCardDiv.querySelector(".info-row").remove();
//     console.log(recipeCardDiv);
//     cardTemplate = recipeCardDiv;
//   } else {
//     recipeCardDiv = cardTemplate;
//   }

//   const results = document.getElementById("results");

//   // Clear results
//   const cards = results.querySelectorAll(".card");
//   for (const card of cards) {
//     card.remove();
//   }

//   for (const recipe of searchedRecipeIDs) {
//     const card = recipeCardDiv.cloneNode(true);
//     card.setAttribute("recipeID", recipe["id"]);
//     card.setAttribute("Added", false);
//     const img = card.querySelector("img");
//     img.src = recipe["image"];
//     const title = card.querySelector(".card__title");
//     title.innerText = recipe["title"];
//     card.addEventListener("click", (e) => {
//       if (card.getAttribute("Added") == "false") {
//         // alert(`Main body click, Added: ${card.getAttribute('Added')}`);
//         window.location.href = `/previewRecipe?id=${recipe["id"]}`;
//       }
//     });
//     card.querySelector(".add-to-cookbook").addEventListener("click", (e) => {
//       card.setAttribute("Added", "true");
//       window.location.href = `/previewRecipe?id=${recipe["id"]}`;
//       // alert(`recipeID: ${recipe['id']}, Title: ${recipe['title']}`);
//     });

//     results.appendChild(card);
//   }
// }
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon Nov 29 2021 20:00:58 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
